name: Check Version Change

on:
  pull_request:
    branches:
      - master 

jobs:
  check_version_change:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        
      - name: Check for Version Change
        run: |
          echo default
          previous_version=$(git show origin/${{ github.base_ref }}:setup.py | grep -oE 'version="[0-9.]+"' | cut -d '"' -f 2)
          echo $previous_version
          current_version=$(grep -oE 'version="[0-9.]+"' setup.py | cut -d '"' -f 2)
          echo $current_version
          if [ "$previous_version" != "$current_version" ] && [ "$(printf "%s\n" "$previous_version" "$current_version" | sort -V | head -n1)" = "$current_version" ]; then
            echo "Version changed from $previous_version to $current_version"
            exit 0  # Exit with success status to allow the pull request merge
          else
            echo "Version change detected, but the new version isn't greater than the old one"
            exit 1  # Exit with failure status to disallow the pull request merge
          fi


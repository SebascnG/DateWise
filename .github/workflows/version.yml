name: Check Version Change

on:
  pull_request:
    branches:
      - master 

jobs:
  check_version_change:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Check for current Version
        run: |
          current_version=$(grep -oE 'version="[0-9.]+"' setup.py | cut -d '"' -f 2)
          current_version_int=$((current_version))
          echo $current_version_int

      - name: Checkout code master
        uses: actions/checkout@v4
        with:
          ref: master

      - name: Check for old Version
        run: |
          previous_version=$(git grep -oE 'version="[0-9.]+"' setup.py | cut -d '"' -f 2)
          previous_version_int=$((previous_version))
          echo $previous_version_int

      - name: Compare versions
        run: |      
          if [ "$previous_version_int" -lt "$current_version_int" ]; then
            echo "Version changed from $previous_version to $current_version"
            exit 0  # Exit with success status to allow the pull request merge
          else
            echo "Version change detected, but the new version isn't greater than the old one"
            exit 1  # Exit with failure status to disallow the pull request merge
          fi

